<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess - Pro AI Edition</title>
    <style>
        :root {
            --bg: #2c3e50;
            --cont: #ffffff;
            --text: #2c3e50;
            --accent: #3498db;
            --board-dark: #b58863;
            --board-light: #f0d9b5;
            --guide-color: #ffff00;
        }

        [data-theme="dark"] {
            --bg: #2c3e50;
            --cont: #34495e;
            --text: #ecf0f1;
            --board-dark: #4b7399;
            --board-light: #eae9d2;
        }

        [data-theme="light"] {
            --bg: #f1f2f6;
            --cont: #ffffff;
            --text: #2c3e50;
        }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: 0.3s;
            overflow: hidden;
        }
        
        .nav-btn {
            position: absolute;
            top: 20px;
            background: #e67e22;
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            z-index: 1000;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 0 #d35400;
        }

        .small-btn { 
            position: absolute; 
            top: 20px; 
            background: rgba(0,0,0,0.1); 
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            z-index: 1000;
            color: var(--text);
        }

        .theme-btn { right: 55px; } 
        .sett-btn { right: 20px; } 
        .home-btn { left: 20px; }

        #lobby, #game-container, #settings-panel {
            background: var(--cont);
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            width: 450px;
            position: relative;
        }

        #game-container, #settings-panel { display: none; }
        
        .card {
            margin-bottom: 0.8rem;
            padding: 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            text-align: left;
            transition: 0.3s;
        }

        .card.disabled {
            opacity: 0.3;
            pointer-events: none;
        }

        select, button {
            padding: 8px;
            width: 100%;
            margin-top: 5px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: var(--bg);
            color: var(--text);
        }

        .action-btn {
            background: var(--accent);
            color: white;
            border: none;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
            box-shadow: 0 4px 0 #2980b9;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            width: 400px;
            height: 400px;
            border: 5px solid #333;
            margin: 15px auto;
            user-select: none;
        }

        .sq {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 35px;
            cursor: pointer;
            position: relative;
        }

        .sq.light { background: var(--board-light); }
        .sq.dark { background: var(--board-dark); }
        .sq.selected { background: #7b61ff !important; }
        .sq.in-check { background: #ff4757 !important; }
        
        .guide {
            position: absolute;
            pointer-events: none;
            z-index: 5;
            transition: 0.2s;
        }
        
        .guide-ring {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 3px solid var(--guide-color);
        }

        .guide-neon {
            box-shadow: 0 0 10px var(--guide-color), inset 0 0 5px var(--guide-color);
            animation: pulse 1.5s infinite;
        }
        
        .guide-icon {
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .guide-icon-color {
            color: var(--guide-color);
            filter: grayscale(1) brightness(1.5) sepia(1) hue-rotate(50deg) saturate(5);
        }

        .guide-icon-neon {
            filter: drop-shadow(0 0 8px var(--guide-color));
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        #end-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
            box-sizing: border-box;
        }

        #end-menu h2 { color: #f1c40f; margin-bottom: 20px; }
    </style>
</head>
<body data-theme="dark">
    <a href="../index.html" class="nav-btn home-btn">üè† HOME</a>
    <button class="small-btn theme-btn" onclick="toggleTheme()">üåì</button>
    <button class="small-btn sett-btn" id="live-sett-btn" style="display:none" onclick="showSettings()">‚öôÔ∏è</button>

    <div id="lobby">
        <h1>Chess</h1>
        <div class="card">
            <label>MODE</label>
            <select id="gm" onchange="checkMode()">
                <option value="pvp">2 PLAYER</option>
                <option value="ai">vs COMPUTER</option>
            </select>
        </div>
        <div class="card" id="ai-diff-card" style="opacity: 0.3; pointer-events: none;">
            <label>AI DIFFICULTY</label>
            <select id="ai-level">
                <option value="easy">Easy</option>
                <option value="medium" selected>Medium</option>
                <option value="hard">Hard</option>
            </select>
        </div>
        <div class="card">
            <label>VARIANT</label>
            <select id="variant" onchange="noopyMode = this.value === 'noopy'">
                <option value="classic">Classic Chess</option>
                <option value="noopy">Noopy Chess (Capture King)</option>
            </select>
        </div>
        <div class="card">
            <label>GUIDE STYLE</label>
            <select id="guide-style-select" onchange="currentStyle = this.value">
                <option value="neon">Neon</option>
                <option value="normal">Normal Color</option>
                <option value="icon">Icon</option>
                <option value="icon-color">Icon with Color</option>
                <option value="icon-neon">Icon with Neon</option>
            </select>
        </div>
        <div class="card">
            <label>ICON & COLOR</label>
            <div style="display:flex; gap:10px;">
                <select id="guide-icon-select" onchange="currentEmoji = this.value" style="flex:2">
                    <option value="ü§ñ">ü§ñ Robot</option><option value="üëæ">üëæ Alien</option><option value="üêç">üêç Snake</option>
                    <option value="üß†">üß† Brain</option><option value="üé≤">üé≤ Dice</option><option value="üéÆ">üéÆ Game</option>
                </select>
                <input type="color" id="neon-picker" value="#ffff00" onchange="updateGuideColor(this.value)" style="flex:1; height:40px;">
            </div>
        </div>
        <button class="action-btn" onclick="startGame()">START GAME</button>
    </div>

    <div id="settings-panel">
        <h2>SETTINGS</h2>
        <div class="card">
            <label>Guide Style</label>
            <select id="style-live" onchange="currentStyle = this.value; renderBoard();">
                <option value="neon">Neon</option>
                <option value="normal">Normal Color</option>
                <option value="icon">Icon</option>
                <option value="icon-color">Icon with Color</option>
                <option value="icon-neon">Icon with Neon</option>
            </select>
        </div>
        <div class="card"><label>Color</label><input type="color" id="neon-picker-live" onchange="updateGuideColor(this.value)"></div>
        <button class="action-btn" onclick="hideSettings()">RESUME</button>
    </div>

    <div id="game-container">
        <div id="status" style="font-weight:bold; margin-bottom: 5px;">White's Turn</div>
        <div id="board"></div>
        <div id="end-menu">
            <h2 id="win-text">CHECKMATE!</h2>
            <button class="action-btn" onclick="resetGame()">NEXT ROUND</button>
            <button class="action-btn" onclick="showSettings()">SETTINGS</button>
            <button class="action-btn" onclick="location.reload()" style="background:#95a5a6; box-shadow: 0 4px 0 #7f8c8d;">MAIN MENU</button>
        </div>
    </div>

<script>
    const piecesMap = { 'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'p': '‚ôü', 'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî', 'P': '‚ôô' };
    const pieceValues = { 'p': 10, 'n': 30, 'b': 30, 'r': 50, 'q': 90, 'k': 900 };
    
    let board = [], selected = null, turn = 'white', gameActive = false, mode = 'pvp', aiLevel = 'medium', currentEmoji = 'ü§ñ', currentStyle = 'neon', noopyMode = false;

    function updateGuideColor(val) { 
        document.documentElement.style.setProperty('--guide-color', val); 
        document.getElementById('neon-picker').value = document.getElementById('neon-picker-live').value = val;
    }

    function toggleTheme() { document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark'; }
    
    function checkMode() {
        const val = document.getElementById('gm').value;
        const card = document.getElementById('ai-diff-card');
        if (val === 'ai') {
            card.style.opacity = "1";
            card.style.pointerEvents = "auto";
        } else {
            card.style.opacity = "0.3";
            card.style.pointerEvents = "none";
        }
    }

    function showSettings() { document.getElementById('settings-panel').style.display='block'; document.getElementById('game-container').style.display='none'; }
    function hideSettings() { document.getElementById('settings-panel').style.display='none'; document.getElementById('game-container').style.display='block'; }

    function startGame() {
        mode = document.getElementById('gm').value;
        aiLevel = document.getElementById('ai-level').value;
        noopyMode = document.getElementById('variant').value === 'noopy';
        currentEmoji = document.getElementById('guide-icon-select').value;
        currentStyle = document.getElementById('guide-style-select').value;
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        document.getElementById('live-sett-btn').style.display = 'flex';
        resetGame();
    }

    function resetGame() {
        board = [
            ['r','n','b','q','k','b','n','r'], ['p','p','p','p','p','p','p','p'],
            ['','','','','','','',''], ['','','','','','','',''],
            ['','','','','','','',''], ['','','','','','','',''],
            ['P','P','P','P','P','P','P','P'], ['R','N','B','Q','K','B','N','R']
        ];
        turn = 'white'; gameActive = true; selected = null;
        document.getElementById('end-menu').style.display = 'none';
        renderBoard();
    }

    function renderBoard() {
        const boardEl = document.getElementById('board');
        boardEl.innerHTML = '';
        const kingPos = findKing(turn);
        const inCheck = !noopyMode && kingPos && isSquareAttacked(kingPos.r, kingPos.c, turn);
        const legalMoves = selected ? (noopyMode ? getPseudoLegalMoves(board, selected.r, selected.c) : getStrictLegalMoves(selected.r, selected.c)) : [];

        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                const sq = document.createElement('div');
                sq.className = `sq ${(r + c) % 2 === 0 ? 'light' : 'dark'}`;
                if (selected && selected.r === r && selected.c === c) sq.classList.add('selected');
                if (inCheck && kingPos && r === kingPos.r && c === kingPos.c) sq.classList.add('in-check');
                
                const piece = board[r][c];
                sq.innerText = piecesMap[piece] || '';
                sq.style.color = (piece && piece === piece.toUpperCase()) ? "white" : "black";

                if (legalMoves.some(m => m.r === r && m.c === c)) {
                    const guide = document.createElement('div');
                    guide.className = 'guide';
                    if (currentStyle === 'neon') guide.className += ' guide-ring guide-neon';
                    else if (currentStyle === 'normal') guide.className += ' guide-ring';
                    else {
                        guide.className += ' guide-icon';
                        guide.innerText = currentEmoji;
                        if (currentStyle === 'icon-color') guide.className += ' guide-icon-color';
                        if (currentStyle === 'icon-neon') guide.className += ' guide-icon-neon';
                    }
                    sq.appendChild(guide);
                }
                sq.onclick = () => handleSquareClick(r, c);
                boardEl.appendChild(sq);
            }
        }
        document.getElementById('status').innerText = turn.charAt(0).toUpperCase() + turn.slice(1) + "'s Turn" + (noopyMode ? " [NOOPY]" : (inCheck ? " (CHECK)" : ""));
    }

    function handleSquareClick(r, c) {
        if (!gameActive || (mode === 'ai' && turn === 'black')) return;
        const piece = board[r][c];
        const isWhitePiece = piece && piece === piece.toUpperCase();

        if (selected) {
            const moves = noopyMode ? getPseudoLegalMoves(board, selected.r, selected.c) : getStrictLegalMoves(selected.r, selected.c);
            if (moves.some(m => m.r === r && m.c === c)) {
                executeMove(selected.r, selected.c, r, c);
                return;
            }
        }
        if (piece && ((turn === 'white' && isWhitePiece) || (turn === 'black' && !isWhitePiece))) {
            selected = { r, c };
        } else {
            selected = null;
        }
        renderBoard();
    }

    function getStrictLegalMoves(r, c, b = board) {
        const rawMoves = getPseudoLegalMoves(b, r, c);
        const side = (b[r][c] === b[r][c].toUpperCase()) ? 'white' : 'black';
        return rawMoves.filter(m => {
            const ghostBoard = b.map(row => [...row]);
            ghostBoard[m.r][m.c] = ghostBoard[r][c];
            ghostBoard[r][c] = '';
            const kingPos = findKing(side, ghostBoard);
            return !kingPos || !isSquareAttacked(kingPos.r, kingPos.c, side, ghostBoard);
        });
    }

    function getPseudoLegalMoves(currentBoard, r, c) {
        const piece = currentBoard[r][c].toLowerCase();
        const isWhite = currentBoard[r][c] === currentBoard[r][c].toUpperCase();
        let moves = [];
        const addMove = (nr, nc) => {
            if (nr < 0 || nr > 7 || nc < 0 || nc > 7) return false;
            const target = currentBoard[nr][nc];
            if (!target) { moves.push({r: nr, c: nc}); return true; }
            if (isWhite !== (target === target.toUpperCase())) { moves.push({r: nr, c: nc}); }
            return false;
        };

        if (piece === 'p') {
            const dir = isWhite ? -1 : 1;
            if (currentBoard[r + dir] && !currentBoard[r + dir][c]) {
                moves.push({r: r + dir, c: c});
                if (((isWhite && r === 6) || (!isWhite && r === 1)) && currentBoard[r + 2*dir] && !currentBoard[r + 2*dir][c]) moves.push({r: r + 2*dir, c: c});
            }
            [1, -1].forEach(off => {
                const tr = r + dir, tc = c + off;
                if (tr >= 0 && tr < 8 && tc >= 0 && tc < 8) {
                    const t = currentBoard[tr][tc];
                    if (t && isWhite !== (t === t.toUpperCase())) moves.push({r: tr, c: tc});
                }
            });
        } else if (piece === 'n') {
            [ [2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2] ].forEach(m => addMove(r + m[0], c + m[1]));
        } else if (piece === 'k') {
            [ [1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1] ].forEach(m => {
                const nr = r + m[0], nc = c + m[1];
                if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8) {
                    const target = currentBoard[nr][nc];
                    if (!target || isWhite !== (target === target.toUpperCase())) {
                        if (noopyMode || !isKingNearby(nr, nc, isWhite ? 'white' : 'black', currentBoard)) moves.push({r: nr, c: nc});
                    }
                }
            });
        } else {
            const directions = piece === 'r' ? [[1,0],[-1,0],[0,1],[0,-1]] : piece === 'b' ? [[1,1],[1,-1],[-1,1],[-1,-1]] : [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];
            directions.forEach(d => {
                for (let i = 1; i < 8; i++) {
                    const nr = r + d[0]*i, nc = c + d[1]*i;
                    if (nr < 0 || nr > 7 || nc < 0 || nc > 7) break;
                    if (!currentBoard[nr][nc]) { moves.push({r: nr, c: nc}); } 
                    else {
                        if (isWhite !== (currentBoard[nr][nc] === currentBoard[nr][nc].toUpperCase())) moves.push({r: nr, c: nc});
                        break;
                    }
                }
            });
        }
        return moves;
    }

    function isSquareAttacked(r, c, side, b = board) {
        const enemy = side === 'white' ? 'black' : 'white';
        for (let i = 0; i < 8; i++) {
            for (let j = 0; j < 8; j++) {
                const p = b[i][j];
                if (p && (enemy === 'white' ? p === p.toUpperCase() : p === p.toLowerCase())) {
                    if (getPseudoLegalMoves(b, i, j).some(m => m.r === r && m.c === c)) return true;
                }
            }
        }
        return false;
    }

    function isKingNearby(r, c, side, b) {
        const target = side === 'white' ? 'k' : 'K';
        for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
                if (i === 0 && j === 0) continue;
                const nr = r + i, nc = c + j;
                if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8 && b[nr][nc] === target) return true;
            }
        }
        return false;
    }

    function findKing(side, b = board) {
        const target = side === 'white' ? 'K' : 'k';
        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                if (b[r][c] === target) return {r, c};
            }
        }
        return null;
    }

    function executeMove(fr, fc, tr, tc) {
        const target = board[tr][tc];
        if (noopyMode && target.toLowerCase() === 'k') {
            endGame(turn.toUpperCase() + " CAPTURED KING!");
            return;
        }

        board[tr][tc] = board[fr][fc];
        board[fr][fc] = '';
        if (board[tr][tc] === 'P' && tr === 0) board[tr][tc] = 'Q';
        if (board[tr][tc] === 'p' && tr === 7) board[tr][tc] = 'q';

        selected = null;
        turn = turn === 'white' ? 'black' : 'white';
        
        if (!noopyMode && gameActive) {
            const hasMoves = canPlayerMove(turn);
            const kingPos = findKing(turn);
            const inCheck = kingPos && isSquareAttacked(kingPos.r, kingPos.c, turn);
            if (!hasMoves) {
                endGame(inCheck ? "CHECKMATE!" : "STALEMATE!");
            }
        }

        renderBoard();
        if (gameActive && mode === 'ai' && turn === 'black') setTimeout(aiMove, 600);
    }

    function endGame(text) {
        gameActive = false;
        document.getElementById('end-menu').style.display = 'flex';
        document.getElementById('win-text').innerText = text;
    }

    function canPlayerMove(side) {
        for (let r = 0; r < 8; r++) {
            for (let c = 0; c < 8; c++) {
                const p = board[r][c];
                if (p && (side === 'white' ? p === p.toUpperCase() : p === p.toLowerCase())) {
                    if (getStrictLegalMoves(r, c).length > 0) return true;
                }
            }
        }
        return false;
    }

    // --- AI MODES ---
    function aiMove() {
        let all = [];
        for(let r = 0; r < 8; r++) {
            for(let c = 0; c < 8; c++) {
                const p = board[r][c];
                if (p && p === p.toLowerCase()) {
                    const ms = noopyMode ? getPseudoLegalMoves(board, r, c) : getStrictLegalMoves(r, c);
                    ms.forEach(m => {
                        let score = evaluateMove(r, c, m.r, m.c);
                        all.push({fr:r, fc:c, tr:m.r, tc:m.c, score});
                    });
                }
            }
        }

        if (!all.length) return;

        // Logic based on level
        if (aiLevel === 'easy') {
            // Mostly random
            const move = all[Math.floor(Math.random() * all.length)];
            executeMove(move.fr, move.fc, move.tr, move.tc);
        } else if (aiLevel === 'medium') {
            // Prioritize captures and basic score
            all.sort((a, b) => b.score - a.score);
            const bestMoves = all.filter(m => m.score === all[0].score);
            const move = bestMoves[Math.floor(Math.random() * bestMoves.length)];
            executeMove(move.fr, move.fc, move.tr, move.tc);
        } else {
            // Hard: Prioritize highest score and protect pieces
            all.sort((a, b) => b.score - a.score);
            executeMove(all[0].fr, all[0].fc, all[0].tr, all[0].tc);
        }
    }

    function evaluateMove(fr, fc, tr, tc) {
        let score = 0;
        const target = board[tr][tc];
        const piece = board[fr][fc].toLowerCase();

        // Capture value
        if (target) {
            score += pieceValues[target.toLowerCase()] || 10;
        }

        // Hard/Medium logic: avoid moving into attack
        if (aiLevel !== 'easy') {
            const ghostBoard = board.map(row => [...row]);
            ghostBoard[tr][tc] = ghostBoard[fr][fc];
            ghostBoard[fr][fc] = '';
            if (isSquareAttacked(tr, tc, 'black', ghostBoard)) {
                score -= (pieceValues[piece] || 10);
            }
        }

        // Slight bonus for center control
        if (tr >= 2 && tr <= 5 && tc >= 2 && tc <= 5) score += 1;
        
        return score;
    }
</script>
</body>
</html>