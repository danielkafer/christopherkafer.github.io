<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reaction Test - Color Custom</title>
    <style>
        :root { --bg: #2c3e50; --cont: #ffffff; --text: #2c3e50; --accent: #3498db; --test-area: #34495e; --wait-color: #e74c3c; --ready-color: #2ecc71; }
        [data-theme="dark"] { --bg: #2c3e50; --cont: #34495e; --text: #ecf0f1; --test-area: #2c3e50; }
        [data-theme="light"] { --bg: #f1f2f6; --cont: #ffffff; --text: #2c3e50; --test-area: #ecf0f1; }
        
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; transition: 0.3s; overflow: hidden; }
        
        .nav-btn { position: absolute; top: 20px; background: #e67e22; color: white; text-decoration: none; padding: 10px 15px; border-radius: 10px; font-size: 14px; font-weight: bold; z-index: 1000; cursor: pointer; border: none; box-shadow: 0 4px 0 #d35400; }
        .nav-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #d35400; }
        .home-btn { left: 20px; } 
        
        .small-btn { position: absolute; top: 20px; background: rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; z-index: 1000; color: var(--text); }
        .theme-btn { right: 55px; }
        .sett-btn { right: 20px; }

        #lobby, #game-container, #settings-panel { background: var(--cont); padding: 2rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; width: 400px; position: relative; }
        #game-container, #settings-panel { display: none; }
        
        .card { margin-bottom: 0.8rem; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 10px; text-align: left; }
        .color-row { display: flex; align-items: center; justify-content: space-between; margin-top: 5px; }
        input[type="color"] { border: none; width: 40px; height: 40px; cursor: pointer; background: none; }
        
        select, button { padding: 10px; width: 100%; margin-top: 5px; border-radius: 8px; border: 1px solid #ddd; background: var(--bg); color: var(--text); }
        .action-btn { background: var(--accent); color: white; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; box-shadow: 0 4px 0 #2980b9; }

        #test-area {
            width: 100%; height: 250px; background: var(--test-area); border-radius: 15px; margin: 20px 0;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            font-size: 1.5rem; font-weight: bold; user-select: none; transition: background 0.05s;
        }

        #end-menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); border-radius: 20px; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10; padding: 20px; box-sizing: border-box; }
        #end-menu h2 { color: #f1c40f; margin-bottom: 20px; }
    </style>
</head>
<body data-theme="dark">
    <a href="../index.html" class="nav-btn home-btn">üè† HOME</a>
    <button class="small-btn theme-btn" onclick="toggleTheme()">üåì</button>
    <button class="small-btn sett-btn" id="live-sett-btn" style="display:none" onclick="showSettings()">‚öôÔ∏è</button>

    <div id="lobby">
        <h1 style="margin-top:0;">Reaction Test</h1>
        
        <div class="card">
            <label>Customize Colors</label>
            <div class="color-row">
                <span>Waiting Color:</span>
                <input type="color" id="wait-picker" value="#e74c3c" onchange="updateColors()">
            </div>
            <div class="color-row">
                <span>Ready Color:</span>
                <input type="color" id="ready-picker" value="#2ecc71" onchange="updateColors()">
            </div>
        </div>

        <p>Wait for the screen to change and click as fast as you can!</p>
        <button class="action-btn" onclick="startGame()">START TEST</button>
    </div>

    <div id="settings-panel">
        <h2>SETTINGS</h2>
        <div class="card">
            <label>Edit Colors</label>
            <div class="color-row">
                <span>Waiting:</span>
                <input type="color" id="wait-picker-live" onchange="updateColors(true)">
            </div>
            <div class="color-row">
                <span>Ready:</span>
                <input type="color" id="ready-picker-live" onchange="updateColors(true)">
            </div>
        </div>
        <button class="action-btn" onclick="hideSettings()">RESUME</button>
    </div>

    <div id="game-container">
        <div style="display:flex; justify-content:space-around; margin-bottom:10px;">
            <div>Best: <span id="best-score">--</span>ms</div>
            <div>Wins: <span id="match-wins">0</span></div>
        </div>
        
        <div id="test-area" onclick="handleAreaClick()">CLICK TO START</div>

        <div id="end-menu">
            <h2 id="win-text">000ms</h2>
            <button class="action-btn" onclick="resetGame()">TRY AGAIN</button>
            <button class="action-btn" onclick="showSettings()">SETTINGS</button>
            <button class="action-btn" onclick="location.reload()" style="background:#95a5a6; box-shadow:0 4px 0 #7f8c8d">MAIN MENU</button>
        </div>
    </div>

<script>
    let state = "IDLE"; // IDLE, WAITING, READY, TOO_SOON, DONE
    let startTime, timeoutId, bestScore = Infinity, matches = 0;
    
    function updateColors(live = false) {
        const wait = live ? document.getElementById('wait-picker-live').value : document.getElementById('wait-picker').value;
        const ready = live ? document.getElementById('ready-picker-live').value : document.getElementById('ready-picker').value;
        document.documentElement.style.setProperty('--wait-color', wait);
        document.documentElement.style.setProperty('--ready-color', ready);
        // Keep pickers synced
        document.getElementById('wait-picker').value = document.getElementById('wait-picker-live').value = wait;
        document.getElementById('ready-picker').value = document.getElementById('ready-picker-live').value = ready;
    }

    function toggleTheme() { document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark'; }
    function showSettings() { document.getElementById('settings-panel').style.display='block'; document.getElementById('game-container').style.display='none'; }
    function hideSettings() { document.getElementById('settings-panel').style.display='none'; document.getElementById('game-container').style.display='block'; }

    function startGame() {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        document.getElementById('live-sett-btn').style.display = 'flex';
        resetGame();
    }

    function resetGame() {
        state = "IDLE";
        testArea.innerText = "CLICK TO START";
        testArea.style.background = "var(--test-area)";
        document.getElementById('end-menu').style.display = 'none';
    }

    const testArea = document.getElementById('test-area');
    const winText = document.getElementById('win-text');

    function handleAreaClick() {
        if (state === "IDLE") {
            startWaiting();
        } else if (state === "WAITING") {
            tooSoon();
        } else if (state === "READY") {
            finish();
        } else if (state === "TOO_SOON") {
            resetGame();
        }
    }

    function startWaiting() {
        state = "WAITING";
        testArea.innerText = "WAITING...";
        testArea.style.background = "var(--wait-color)";
        
        const delay = Math.random() * 4000 + 1000;
        timeoutId = setTimeout(() => {
            state = "READY";
            testArea.innerText = "CLICK NOW!";
            testArea.style.background = "var(--ready-color)";
            startTime = Date.now();
        }, delay);
    }

    function tooSoon() {
        clearTimeout(timeoutId);
        state = "TOO_SOON";
        testArea.innerText = "TOO SOON! CLICK TO RESET";
        testArea.style.background = "#f1c40f";
    }

    function finish() {
        const reactionTime = Date.now() - startTime;
        state = "DONE";
        if (reactionTime < bestScore) {
            bestScore = reactionTime;
            document.getElementById('best-score').innerText = bestScore;
            matches++;
            document.getElementById('match-wins').innerText = matches;
        }
        winText.innerText = reactionTime + "ms";
        document.getElementById('end-menu').style.display = 'flex';
    }
</script>
</body>
</html>